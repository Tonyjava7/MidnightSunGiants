<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Firebase Web Basics</title>

    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,500,700" rel="stylesheet">
    <script src="https://use.fontawesome.com/939e9dd52c.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>

</head>

<body>

    <!-- <div class="mainDiv" align="right">
        <h1 align="left">Firebase File Upload</h1>
        <progress id="uploader" value="0" max="100">0%</progress>
        <input type="file" id="fileButton" value="upload" />
    </div> -->
    <!-- <div class="container screen" id="picture_screen">
        <div class="row">
            <div class="col-md-12">
                <br>
                <label for="upload_btn">
                <h3>Upload a Picture</h3>
                </label> -->
    <!-- <button id="upload_btn">Upload</button> -->
    <!-- </div> -->
    <div class="mainDiv" align="left">
        <h1 align="left">Firebase File Upload</h1>
        <progress id="uploader" value="0" max="100">0%</progress>
        <input type="file" id="fileButton" value="upload" />
    </div>

    <!-- <form role="form">
        <div class="form-group">
            <input class="form-control" id="photo-input" type="text">
        </div>
        <button class="btn btn-default" id="add-photo" type="submit">Upload</button>
        <hr>
    </form> -->
    <div class="row">
        <div class="col-md-12" id="well">
        </div>
    </div>
    <div class="row">
        <div class="col-md-12" id="imagesource">
        </div>
    </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <img src="images/screen1.jpeg" class="photo" alt="picture three" height="200">
            <img src="images/screen2.jpeg" class="photo" alt="picture four" width="200">
        </div>
    </div>
    </div>

    <script>
        var city = "";

        //geolocator starts here
        var key = "a9a61bb81ae8bbec";
        navigator.geolocation.getCurrentPosition(success, error);

        function error() {
            alert("Sorry, we're unable to retrieve your location.");
        }

        function success(position) {
            latitude = position.coords.latitude;
            longitude = position.coords.longitude;
            $.getJSON("https://api.wunderground.com/api/" + key + "/forecast/geolookup/conditions/q/" + latitude + "," + longitude + ".json", function(data) {
                city = data.location.city;
            });
        };
        //geolocator ends here


        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBn5xUU9cipD3IVxgi750aYFO-bM_AM85A",
            authDomain: "midnightsungiants.firebaseapp.com",
            databaseURL: "https://midnightsungiants.firebaseio.com",
            projectId: "midnightsungiants",
            storageBucket: "midnightsungiants.appspot.com",
            messagingSenderId: "849065062207"
        };

        firebase.initializeApp(config);

        var storageRef = firebase.storage();
        var uploader = document.getElementById('uploader');
        var fileButton = document.getElementById('fileButton');
        fileButton.addEventListener('change', function(e) {

            var file = e.target.files[0];
            var dataRef = storageRef.ref('img/' + file.name);

            var metadata = {
                customMetadata: {
                    'city': city
                }
            }
            var task = dataRef.put(file, metadata);
            task.on('state_changed', function progress(snapshot) {
                var percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                uploader.value = percentage;

            }, function error(err) {}, function complete() {
                var downloadURL = task.snapshot.downloadURL;
                $('#well').append('<img src=' + downloadURL + '>');
            });
        });
    </script>

    </script>
</body>

</html>